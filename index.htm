<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EKUSFM by ESTACIONKUSMEDIOS</title>
  <!-- FontAwesome CDN para iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1e293b">
  <link rel="icon" type="image/png" href="icon.png">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="stylesheet" href="style.css">
  <style>
    /* Posiciona el bot√≥n Fix */
    #fixBtn {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 10010;
      background: #1e293b;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.22);
      font-size: 2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #fixBtn:active { background: #334155; }
    #fixAlert {
      position: fixed;
      bottom: 90px;
      right: 24px;
      background: #fff;
      color: #222;
      border-radius: 8px;
      padding: 15px 22px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      font-size: 1rem;
      z-index: 10020;
      display: none;
    }
  </style>
</head>
<body>
  <img id="background" class="background" src="/placeholder.svg" alt="Background">
  <div class="overlay"></div>

  <div class="header">
    <div class="logo" id="radio-name">
      EKUSMEDIOS
    </div>
    <button class="menu-btn" id="menuBtn">
      <i class="fas fa-bars"></i>
    </button>
  </div>

  <div class="main-content">
    <div class="status-badge status-live" id="status-badge">
      <i class="fas fa-broadcast-tower"></i>
      <span id="status-text">Transmitiendo en vivo desde nuestra cabina central üéôÔ∏è en digital</span>
    </div>

    <div class="cover-container">
      <img src="/placeholder.svg" alt="Album Cover" width="250%" height="108%" class="cover-img" id="cover-img">
    </div>

    <div class="song-info">
      <div class="song-title" id="song-title">Cargando...</div>
      <div class="artist-name" id="artist-name">Espere un momento</div>
      <div class="now-playing" id="now-playing-text">Actualmente escuchas üé∂</div>
    </div>

    <div class="controls">
      <button class="control-btn" id="prevBtn" disabled>
        <i class="fas fa-step-backward"></i>
      </button>
      <button class="play-btn" id="playPauseBtn">
        <i class="fas fa-play"></i>
      </button>
      <button class="control-btn" id="nextBtn" disabled>
        <i class="fas fa-step-forward"></i>
      </button>
    </div>

    <div class="volume-container">
      <div class="volume-icon">
        <i class="fas fa-volume-up" id="volumeIcon"></i>
      </div>
      <input type="range" class="volume-control" id="volumeControl" min="0" max="1" step="0.01" value="1">
    </div>

    <div class="status-indicator" id="statusIndicator"></div>

    <div class="social-buttons" id="social-buttons">
      <!-- Social buttons will be added din√°micamente -->
    </div>
  </div>

  <!-- Templates de mantenimiento/desactivado -->
  <div class="maintenance-mode" id="maintenanceMode" style="display: none; text-align: center; padding: 20px;">
    <h1>Sitio en Mantenimiento</h1>
    <p>Estamos realizando algunas actualizaciones. Volveremos pronto.</p>
    <img src="maintenance.png" alt="Maintenance" style="width: 200px; margin-top: 20px;">
  </div>
  <div class="disabled-mode" id="disabledMode" style="display: none; text-align: center; padding: 20px;">
    <h1>Sitio Desactivado</h1>
    <p>Este sitio web ha sido desactivado.</p>
  </div>
  <div class="desactivated-mode" id="desactivatedMode" style="display: none; text-align: center; padding: 20px;">
    <h1>Servicio No Disponible</h1>
    <p>Este servicio ya no est√° disponible.</p>
  </div>

  <div class="menu" id="menu">
    <div class="menu-header">
      <div class="menu-title" id="menu-title"></div>
      <button class="close-menu" id="close-menu">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="menu-section">
      <h3 class="menu-section-title">Opciones</h3>
      <ul class="menu-links">
        <li><a href="#" class="menu-link" id="historyLink"><i class="fas fa-history"></i> Historial de canciones</a></li>
        <li><a href="#" class="menu-link" id="aboutLink"><i class="fas fa-info-circle"></i> Acerca de</a></li>
        <li><a href="#" class="menu-link" id="shareLink"><i class="fas fa-share-alt"></i> Compartir</a></li>
        <li><a href="novedades.htm" class="menu-link"><i class="fas fa-newspaper"></i> Novedades</a></li>
      </ul>
    </div>
    <div class="menu-section">
      <h3 class="menu-section-title">Redes Sociales</h3>
      <ul class="menu-links" id="menu-social-links">
        <!-- Social links will be added din√°micamente -->
      </ul>
    </div>
  </div>

  <!-- Modales -->
  <div class="modal" id="historyModal">
    <div class="modal-content">
      <button class="modal-close" id="closeHistoryModal">&times;</button>
      <h3 class="modal-title">Historial de canciones</h3>
      <div id="historyModalContent">
        <!-- El historial se llenar√° din√°micamente -->
      </div>
    </div>
  </div>
  <div class="modal" id="aboutModal">
    <div class="modal-content">
      <button class="modal-close" id="closeAboutModal">&times;</button>
      <h3 class="modal-title">Acerca de</h3>
      <div class="about-content">
        <img id="aboutLogo" class="about-logo" src="/placeholder.svg" alt="Logo">
        <p class="about-text" id="aboutDescription">Cargando...</p>
        <p class="about-text">Versi√≥n: 1.0.0</p>
        <p class="about-text">Desarrollado con ‚ù§Ô∏è por <span id="aboutDeveloper">ESTACIONKUSMEDIOS</span></p>
        <p class="about-text">Powered by: <strong>ESTACIONKUSMEDIOS</strong></p>
      </div>
    </div>
  </div>
  <div class="modal" id="shareModal">
    <div class="modal-content">
      <button class="modal-close" id="closeShareModal">&times;</button>
      <h3 class="modal-title">Compartir</h3>
      <div id="shareOptions">
        <div class="share-option" id="shareWhatsapp">
          <div class="share-icon" style="background-color: #25D366;">
            <i class="fab fa-whatsapp"></i>
          </div>
          <div class="share-text">Compartir en WhatsApp</div>
        </div>
        <div class="share-option" id="shareFacebook">
          <div class="share-icon" style="background-color: #1877F2;">
            <i class="fab fa-facebook-f"></i>
          </div>
          <div class="share-text">Compartir en Facebook</div>
        </div>
        <div class="share-option" id="shareTwitter">
          <div class="share-icon" style="background-color: #1DA1F2;">
            <i class="fab fa-twitter"></i>
          </div>
          <div class="share-text">Compartir en Twitter</div>
        </div>
        <div class="share-url-container">
          <input type="text" id="shareUrl" class="share-url" readonly>
          <button id="copyLink" class="copy-btn">Copiar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="offline-alert" id="offlineAlert">
    Sin conexi√≥n a internet. Algunas funciones pueden no estar disponibles.
  </div>
  <div class="watermark">Powered by: ESTACIONKUSMEDIOS</div>
  <audio id="audio" preload="auto"></audio>

  <!-- Bot√≥n Fix -->
  <button id="fixBtn" title="Solucionar problemas"><i class="fas fa-wrench"></i></button>
  <div id="fixAlert"></div>

  <script>
    // Configuraci√≥n AzuraCast
    const AZURACAST_URL = "https://radio.estacionkusmedios.com";
    const STATION = "esmerosound";
    const AUDIO_STREAM_URL = "https://radio.estacionkusmedios.com/listen/esmerosound/radio.mp3";

    // Elementos DOM
    const audio = document.getElementById('audio');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const volumeControl = document.getElementById('volumeControl');
    const songTitle = document.getElementById('song-title');
    const artistName = document.getElementById('artist-name');
    const coverImg = document.getElementById('cover-img');
    const background = document.getElementById('background');

    // Inicializa audio
    audio.src = AUDIO_STREAM_URL;
    audio.crossOrigin = "anonymous";
    audio.volume = volumeControl.value;

    // Play/Pause
    playPauseBtn.addEventListener('click', () => {
      if (audio.paused) {
        audio.play();
      } else {
        audio.pause();
      }
    });
    audio.addEventListener('play', () => {
      playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
    });
    audio.addEventListener('pause', () => {
      playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
    });

    // Control de volumen
    volumeControl.addEventListener('input', (e) => {
      audio.volume = e.target.value;
    });

    // Carga metadatos desde AzuraCast API
    async function updateMetadata() {
      try {
        const res = await fetch(`${AZURACAST_URL}/api/nowplaying/${STATION}`);
        if (!res.ok) throw new Error("No se pudo obtener metadatos");
        const data = await res.json();

        songTitle.textContent = data.now_playing.song.title || "Desconocido";
        artistName.textContent = data.now_playing.song.artist || "Desconocido";
        // Portada
        let artUrl = data.now_playing.song.art;
        if (artUrl && artUrl.startsWith('/')) {
          artUrl = AZURACAST_URL + artUrl;
        }
        coverImg.src = artUrl || "/placeholder.svg";
        background.src = artUrl || "/placeholder.svg";
      } catch (e) {
        songTitle.textContent = "Error obteniendo metadatos";
        artistName.textContent = "";
        coverImg.src = "/placeholder.svg";
        background.src = "/placeholder.svg";
      }
    }

    // Actualiza metadatos cada 10 segundos
    setInterval(updateMetadata, 10000);
    updateMetadata();

    // Opcional: auto-play al cargar
    window.addEventListener('DOMContentLoaded', () => {
      audio.load();
    });

    // ------------- MEN√ö Y MODALES -------------

    // MENU
    const menuBtn = document.getElementById('menuBtn');
    const menu = document.getElementById('menu');
    const closeMenuBtn = document.getElementById('close-menu');

    // Muestra/Oculta men√∫
    function openMenu() {
      menu.style.display = 'block';
      setTimeout(() => { menu.classList.add('active'); }, 5);
      document.body.style.overflow = 'hidden';
    }
    function closeMenu() {
      menu.classList.remove('active');
      setTimeout(() => { menu.style.display = 'none'; }, 250);
      document.body.style.overflow = '';
    }

    menuBtn.addEventListener('click', openMenu);
    closeMenuBtn.addEventListener('click', closeMenu);

    // Cerrar men√∫ al hacer click fuera
    window.addEventListener('click', function(e) {
      if (menu.classList.contains('active') && !menu.contains(e.target) && !menuBtn.contains(e.target)) {
        closeMenu();
      }
    });

    // MODALES
    function openModal(id) {
      document.getElementById(id).style.display = 'block';
      document.body.style.overflow = 'hidden';
    }
    function closeModal(id) {
      document.getElementById(id).style.display = 'none';
      document.body.style.overflow = '';
    }

    document.getElementById('historyLink').onclick = (e) => { e.preventDefault(); openModal('historyModal'); };
    document.getElementById('aboutLink').onclick = (e) => { e.preventDefault(); openModal('aboutModal'); };
    document.getElementById('shareLink').onclick = (e) => { e.preventDefault(); openModal('shareModal'); };

    document.getElementById('closeHistoryModal').onclick = () => closeModal('historyModal');
    document.getElementById('closeAboutModal').onclick = () => closeModal('aboutModal');
    document.getElementById('closeShareModal').onclick = () => closeModal('shareModal');

    // Cierra modales al hacer click fuera
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', function(e) {
        if (e.target === modal) closeModal(modal.id);
      });
    });

    // ------------- FIX BUTTON -------------

    const fixBtn = document.getElementById('fixBtn');
    const fixAlert = document.getElementById('fixAlert');
    function showFixAlert(text, time=3500) {
      fixAlert.textContent = text;
      fixAlert.style.display = 'block';
      setTimeout(() => { fixAlert.style.display = 'none'; }, time);
    }

    fixBtn.onclick = () => {
      // 1. Repara men√∫
      try {
        menuBtn.onclick = openMenu;
        closeMenuBtn.onclick = closeMenu;
        menuBtn.disabled = false;
        closeMenuBtn.disabled = false;
        menu.style.display = '';
        menu.classList.remove('active');
      } catch (e) {}

      // 2. Repara audio
      try {
        audio.src = AUDIO_STREAM_URL;
        audio.load();
        audio.volume = volumeControl.value;
        playPauseBtn.innerHTML = audio.paused ? '<i class="fas fa-play"></i>' : '<i class="fas fa-pause"></i>';
      } catch (e) {}

      // 3. Actualiza metadatos
      updateMetadata();

      // 4. Verifica conexi√≥n
      if (!navigator.onLine) {
        showFixAlert('Sin conexi√≥n a internet. Intenta reconectar.');
        return;
      }

      // 5. Recarga scripts si falta alguno
      if (typeof openMenu !== 'function' || typeof updateMetadata !== 'function') {
        showFixAlert('Error cr√≠tico: recarga la p√°gina (F5)');
        return;
      }

      // 6. Si todo ok
      showFixAlert('¬°Solucionado! Si persiste el problema, recarga la p√°gina.');
    };

    // ------------- OTROS -------------
    // Ejemplo para compartir URL
    document.getElementById('shareUrl').value = window.location.href;
    document.getElementById('copyLink').onclick = function() {
      navigator.clipboard.writeText(window.location.href)
        .then(() => showFixAlert('Enlace copiado!'))
        .catch(() => showFixAlert('No se pudo copiar el enlace'));
    };
    // Redirecci√≥n compartir
    document.getElementById('shareWhatsapp').onclick = function() {
      window.open('https://wa.me/?text=' + encodeURIComponent('Escucha la radio aqu√≠: ' + window.location.href),'_blank');
    };
    document.getElementById('shareFacebook').onclick = function() {
      window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(window.location.href),'_blank');
    };
    document.getElementById('shareTwitter').onclick = function() {
      window.open('https://twitter.com/intent/tweet?url=' + encodeURIComponent(window.location.href),'_blank');
    };
  </script>
  <!-- Tu script.js personalizado para otras funciones -->
  <script src="script.js"></script>
<script>
(function() {
  // Elementos del men√∫
  const menuBtn = document.getElementById('menuBtn');
  const menu = document.getElementById('menu');
  const closeMenuBtn = document.getElementById('close-menu');

  // Asegura display block y clase active
  function openMenu() {
    menu.style.display = 'block';
    setTimeout(() => menu.classList.add('active'), 10);
    document.body.style.overflow = 'hidden';
  }
  function closeMenu() {
    menu.classList.remove('active');
    setTimeout(() => {
      menu.style.display = 'none';
      document.body.style.overflow = '';
    }, 200);
  }

  menuBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    openMenu();
  });
  closeMenuBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    closeMenu();
  });

  // Cerrar men√∫ al hacer click fuera del men√∫
  document.addEventListener('click', function(e) {
    if (
      menu.classList.contains('active') &&
      !menu.contains(e.target) &&
      !menuBtn.contains(e.target)
    ) {
      closeMenu();
    }
  });

  // Previene que clicks dentro del men√∫ cierren el men√∫
  menu.addEventListener('click', function(e) {
    e.stopPropagation();
  });

  // Modo seguro: asegura que el men√∫ no quede bloqueado al recargar
  window.addEventListener('pageshow', function() {
    menu.classList.remove('active');
    menu.style.display = 'none';
    document.body.style.overflow = '';
  });
})();
</script>
</body>
</html>